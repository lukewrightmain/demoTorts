<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style2.css">
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
    <title>Ordinal Torts</title>
    <script src="java.js"></script>
    <div class="preloader">
      <div id="loader">
        <img src="images/footerlogo.gif" alt="Loading...">
      </div>
    </div>    
</head>
<body>
    <header>
        <div class="top-bar">
          <div class="social-accounts">
            <a href="">
              <img src="images/discord2.png" alt="social-icon">
            </a>
            <a href="https://twitter.com/ordinaltortoise">
              <img src="images/twitter2.png" alt="social-icon">
            </a>
            <a href="">
              <img src="images/marketplace.png" alt="social-icon">
            </a>
            <a href="">
              <img src="images/envelope2.png" alt="social-icon">
            </a>
          </div>
          <div class="navbar">
            <a href="index.html">
            <button class="navbtn" onclick="scrollToHomeSection()">
              Home
            </button>
            </a>
            <a href="index.html">
            <button class="navbtn" href="#">
              Team
            </button>
            </a>
            <a href="index.html">
            <button class="navbtn about-button" onclick="scrollToAboutSection()" href="#">
              About
            </button>
            </a>
            <button class="navbtn" href="collection.html">
              Collection
            </button>
            <button class="navbtn stake" href="#">
              Stake
            </button>
          </div>
        </div>
      </header>
    <section class="sectwo">
        <div class="sectwo-container">
            <div class="buttons-container">
              <button class="button" onclick="fetchAndProcessData('rarity')">Rarity</button>
              <button class="button" onclick="fetchAndProcessData('number')">Number</button>
              <button class="button" onclick="fetchAndProcessData('inscription')">Inscription</button>
              <input type="text" id="search-bar" placeholder="Search by attribute">
            </div>
            <div class="collection-container">
                <div class="grid-container">
                    <div class="grid-container" id="grid-container">
                      <script>
                        window.onload = function() {
                          fetch('metadata.json')
                            .then(response => response.json())
                            .then(data => {
                              metaData = JSON.stringify(data);
                              fetchAndProcessData('number'); // Default sorting is by number
                              document.getElementById('search-bar').addEventListener('input', handleSearch);
                            })
                            .catch(error => console.error(error));
                        };

                        function handleSearch() {
                          const searchText = document.getElementById('search-bar').value.toLowerCase();
                          const gridContainer = document.getElementById('grid-container');
                          const gridCells = gridContainer.querySelectorAll('.grid-cell');
                          gridCells.forEach(cell => {
                            const cellText = cell.innerText.toLowerCase();
                            if (cellText.includes(searchText)) {
                              cell.style.display = 'block';
                            } else {
                              cell.style.display = 'none';
                            }
                          });
                        }

                        function fetchAndProcessData(sortBy) {
                          let dataUrl = '';
                          if (sortBy === 'number' || sortBy === 'inscription') {
                            dataUrl = 'data.csv';
                          } else if (sortBy === 'rarity') {
                            dataUrl = 'rarity.csv'; // Update the dataUrl variable to point to the rarity.csv file
                          }

                          fetch(dataUrl)
                            .then(response => response.text())
                            .then(data => processData(data, sortBy))
                            .catch(error => console.error(error));
                        }

                        function processData(data, sortBy) {
                          const rows = data.split('\n').slice(1); // Exclude the header row
                          const csvData = rows.map(row => row.split(','));

                          // Sort the csvData array according to the specified criteria
                          if (sortBy === 'number') {
                            csvData.sort((a, b) => parseInt(a[0]) - parseInt(b[0])); // Sort by tort number in descending order
                          } else if (sortBy === 'inscription') {
                            csvData.sort((a, b) => parseInt(a[2]) - parseInt(b[2])); // Sort by inscription number in ascending order
                          } else if (sortBy === 'rarity') {
                            csvData.sort((a, b) => parseFloat(a[1]) - parseFloat(b[1])); // Sort by rarity score in ascending order
                          }

                          const gridContainer = document.getElementById('grid-container');
                          gridContainer.innerHTML = ''; // Clear the grid container before adding cells
                          for (var i = 0; i < csvData.length; i++) {
                            const row = csvData[i];
                            const cell = document.createElement('div');
                            cell.className = 'grid-cell';
                            const box = document.createElement('div');
                            box.className = 'grid-box';
                            const img = document.createElement('img');
                            img.src = `upscaled_torts/${row[0]}.png`;
                            img.alt = `torts/${row[0]}.png`;
                            const text = document.createElement('div');
                            text.className = 'grid-text';
                            const h3 = document.createElement('h3');
                            h3.textContent = `Tort: ${row[0]}`;
                            const metadata = JSON.parse(metaData);
                            const metadataRow = metadata[parseInt(row[0]) - 1];
                            const metadataValues = Object.values(metadataRow);
                            const metadataText = metadataValues.join(' | ');
                            const p1 = document.createElement('p');
                            if (sortBy === 'rarity') {
                              p1.textContent = `Rarity Rank ${row[1]}`;
                            } else {
                              p1.textContent = `Inscription ${row[2]}`;
                            }
                            const p2 = document.createElement('p');
                            p2.textContent = metadataText;
                            text.appendChild(h3);
                            text.appendChild(p1);
                            text.appendChild(p2);
                            box.appendChild(img);
                            box.appendChild(text);
                            cell.appendChild(box);
                            gridContainer.appendChild(cell);
                          }
                        }
                      </script>                                                           
                  </div>
                </div>
            </div>
        </div>
    </section>
</body>
</html>
